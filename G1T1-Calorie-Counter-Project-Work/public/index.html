<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dog Lovers App</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <!-- Bootstrap CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .header {
            background-color: #f8f9fa;
            padding: 20px 0;
            text-align: center;
        }
        .get-random-dog {
            text-align: center;
            margin-bottom: 20px;
        }
        .dog-info {
            padding: 20px;
        }
        .dog-image {
            padding: 20px;
        }
    </style>
</head>
<body>
<div class="container">
    <!-- Login Form -->
    <div id="login-container">
        <h2>Login</h2>
        <form id="login-form">
            <input type="email" id="login-email" placeholder="Email" required>
            <input type="password" id="login-password" placeholder="Password" required>
            <button type="submit">Login</button>
            <p>Don't have an account? <a href="#" id="show-register">Register here</a></p>
        </form>
    </div>
    <!-- Register Form -->
    <div id="register-container">
        <h2>Register</h2>
        <form id="register-form">
            <input type="email" id="register-email" placeholder="Email" required>
            <input type="password" id="register-password" placeholder="Password" required>
            <button type="submit">Register</button>
            <p>Already have an account? <a href="#" id="show-login">Login here</a></p>
        </form>
    </div>

    <!-- Protected Content -->
    <div id="app-container">
        <!-- Your existing Dog Lovers App content -->
        <div class="header">
            <h1>Dog Lovers App</h1>
            <button id="logout-button" class="btn btn-danger">Logout</button>
        </div>

        <div class="get-random-dog">
            <button class="btn btn-primary" onclick="getDogImage()">Get Random Dog</button>
        </div>

        <div class="row">
            <div class="col-md-6 dog-info">
                <p id="dogInfo">Dog info from Wikipedia here</p>
            </div>
            <div class="col-md-6 dog-image">
                <img id="dogImg" src="https://via.placeholder.com/400x300" alt="Dog Image" class="img-fluid">
            </div>
        </div>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-auth.js";

    // Fill in with your own web app's Firebase configuration
    const firebaseConfig = {
        apiKey: "AIzaSyBAhYdiPIDo0OtV-RoIiRVQCxvgofMb0js",
        authDomain: "snack-quest.firebaseapp.com",
        databaseURL: "https://snack-quest-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "snack-quest",
        storageBucket: "snack-quest.appspot.com",
        messagingSenderId: "974726219698",
        appId: "1:974726219698:web:361c5bf4bf98a8798c86ab",
        measurementId: "G-YXRNC4ZPTZ"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    const loginContainer = document.getElementById('login-container');
    const registerContainer = document.getElementById('register-container');
    const appContainer = document.getElementById('app-container');
    const loginForm = document.getElementById('login-form');
    const registerForm = document.getElementById('register-form');
    const showLogin = document.getElementById('show-login');
    const showRegister = document.getElementById('show-register');
    const logoutButton = document.getElementById('logout-button');

    showLogin.addEventListener('click', () => {
        loginContainer.style.display = 'block';
        registerContainer.style.display = 'none';
    });

    showRegister.addEventListener('click', () => {
        loginContainer.style.display = 'none';
        registerContainer.style.display = 'block';
    });

    registerForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const email = document.getElementById('register-email').value;
        const password = document.getElementById('register-password').value;
        try {
            await createUserWithEmailAndPassword(auth, email, password);
            alert('Registration successful. Please log in.');
            showLogin.click();
        } catch (error) {
            alert(error.message);
        }
    });

    loginForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const email = document.getElementById('login-email').value;
        const password = document.getElementById('login-password').value;
        try {
            await signInWithEmailAndPassword(auth, email, password);
        } catch (error) {
            alert(error.message);
        }
    });

    logoutButton.addEventListener('click', async () => {
        await signOut(auth);
    });

    onAuthStateChanged(auth, (user) => {
        if (user) {
            window.location.href = "3DVersion.html"; 
        } else {
            loginContainer.style.display = 'block';
            registerContainer.style.display = 'none';
            appContainer.style.display = 'none';
        }
    });
</script>

<!-- Define getDogImage function in its own script tag -->
<script>
    const dogBreeds = ["labrador", "pug", "beagle", "germanshepherd", "maltese", "boxer", "poodle", "chihuahua", "shiba", "bulldog"];
    const imgElement = document.getElementById('dogImg');
    const dogInfoElement = document.getElementById('dogInfo');

    async function getDogImage() {
        const randomBreed = dogBreeds[Math.floor(Math.random() * dogBreeds.length)];
        
        try {
            const dogImgResponse = await axios.get(`https://dog.ceo/api/breed/${randomBreed}/images/random`);
            imgElement.src = dogImgResponse.data.message;
        } catch (error) {
            console.error(`Error fetching image for breed ${randomBreed}:`, error);
        }

        try {
            const wikiResponse = await axios.get('https://us-central1-snack-quest.cloudfunctions.net/searchWikipedia', { // use your own cloud function URL
                params: {
                    breed: randomBreed
                }
            });
            dogInfoElement.innerHTML = wikiResponse.data;
        } catch (error) {
            console.error(`Error fetching wiki info for breed ${randomBreed}:`, error);
        }
    }
</script>

<!-- Bootstrap Bundle with Popper -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
</body>
</html>