<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registration Page</title>
    <link rel="icon" type="image/x-icon" href="/images/favicon.ico">
    <!-- Include Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        /* General Styles */
        body {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 0;
            text-align: center;
            color: #fff;
            background: linear-gradient(135deg, #2b1d5a, #a296ca, #282b75, #1d161e, #4c1c46);
            background-size: 400% 400%;
            animation: gradientAnimation 30s ease infinite;
            overflow-x: hidden;
        }

        @keyframes gradientAnimation {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Dynamic Stars */
        .star {
            position: absolute;
            background-color: #fff;
            border-radius: 50%;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.8);
            animation: starAnimation linear infinite;
        }

        @keyframes starAnimation {
            0% {
                opacity: 1;
                transform: scale(1);
            }
            70% {
                opacity: 0.5;
                transform: scale(0.5);
            }
            100% {
                opacity: 0;
                transform: scale(0);
                top: calc(100% * var(--newY));
                left: calc(100% * var(--newX));
            }
        }

        h2 {
            color: #fff;
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
        }

        label {
            color: #fff;
        }

        .btn-primary {
            background-color: #4c1c46;
            border-color: #4c1c46;
        }

        .btn-primary:hover {
            background-color: #a296ca;
            border-color: #a296ca;
        }

        .form-control, .form-select {
            background-color: rgba(255, 255, 255, 0.1);
            color: #fff;
            border: none;
            box-shadow: inset 0 0 10px rgba(255, 255, 255, 0.2);
        }

        .form-control:focus, .form-select:focus {
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }
        #lifestyle {
            color: black;
        }
        #goals {
            color:black;
        }
    </style>
</head>
<body>
    <!-- Portal Animation Container -->
    <div id="portalContainer"></div>

    <!-- Dynamic Stars -->
    <script>
        const numStars = 100;
        for (let i = 0; i < numStars; i++) {
            const star = document.createElement('div');
            star.className = 'star';
            const size = Math.random() * 3 + 1;
            star.style.width = `${size}px`;
            star.style.height = `${size}px`;
            star.style.left = Math.random() * 100 + '%';
            star.style.top = Math.random() * 100 + '%';
            star.style.animationDuration = `${Math.random() * 5 + 2}s`;
            star.style.animationDelay = `${Math.random() * 5}s`;
            star.style.setProperty('--newX', Math.random());
            star.style.setProperty('--newY', Math.random());
            document.body.appendChild(star);
        }
    </script>

    <script type="module">
            import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-app.js";
            import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-auth.js";
            import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-firestore.js";

            // Fill in with your own web app's Firebase configuration
            const firebaseConfig = {
                apiKey: "AIzaSyBAhYdiPIDo0OtV-RoIiRVQCxvgofMb0js",
                authDomain: "snack-quest.firebaseapp.com",
                databaseURL: "https://snack-quest-default-rtdb.asia-southeast1.firebasedatabase.app",
                projectId: "snack-quest",
                storageBucket: "snack-quest.appspot.com",
                messagingSenderId: "974726219698",
                appId: "1:974726219698:web:361c5bf4bf98a8798c86ab",
                measurementId: "G-YXRNC4ZPTZ"
            };

            const app = initializeApp(firebaseConfig);
            const auth = getAuth(app);
            const db = getFirestore(app);

            const loginContainer = document.getElementById('login-container');
            const appContainer = document.getElementById('app-container');
            const loginForm = document.getElementById('login-form');
            const registerForm = document.getElementById('registrationForm'); 
            const showRegister = document.getElementById('show-register');
            const logoutButton = document.getElementById('logout-button');


            registerForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const email = document.getElementById('register-email').value;
                const password = document.getElementById('register-password').value;
                const username = document.getElementById('username').value;
                const birthdate = document.getElementById('birthdate').value;
                const height = document.getElementById('height').value;
                const weight = document.getElementById('weight').value;
                const lifestyle = document.getElementById('lifestyle').value;
                const goals = document.getElementById('goals').value;
                const breakfastTime = document.getElementById('breakfast-time').value;
                const lunchTime = document.getElementById('lunch-time').value;
                const dinnerTime = document.getElementById('dinner-time').value;

                try {
                    // Create user with email and password
                    const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                    const userId = userCredential.user.uid;

                    // Prepare user data for Firestore
                    const userData = {
                        username,
                        birthdate,
                        height,
                        weight,
                        lifestyle,
                        goals,
                        mealTimes: {
                            breakfast: breakfastTime,
                            lunch: lunchTime,
                            dinner: dinnerTime
                        }
                    };

                // Save user data to Firestore
                await setDoc(doc(db, "users", userId), userData);
                alert('Entering Main Page');
                window.location.href = "3DVersion.html";
            } catch (error) {
                alert(error.message);
            }
        });
    </script>

    <div class="container mt-5">
        <h2 class="text-center">Registration Form</h2>
        <p>Already have an account? <a href="index.html" id="show-login">Login here</a></p>

        <form id="registrationForm">
            <!-- Username -->
            <div class="mb-3">
                <label for="username" class="form-label">Username</label>
                <input type="text" class="form-control" id="username" placeholder="Enter a username" required>
            </div>
            <div class="mb-3">
                    <label for="username" class="form-label">Email</label>
                    <input type="email" class="form-control" id="register-email" placeholder="Email" required>                    
            </div>

            <!-- Password -->
            <div class="mb-3">
                <label for="password" class="form-label">Password</label>
                <input type="password" class="form-control" id="register-password" placeholder="Enter a password" required>
            </div>

            <!-- Reconfirm Password -->
            <div class="mb-3">
                <label for="reconfirm-password" class="form-label">Reconfirm Password</label>
                <input type="password" class="form-control" id="reconfirm-password" placeholder="Re-enter your password" required>
                <div id="passwordHelp" class="form-text text-danger"></div>
            </div>

            <!-- Birth Date -->
            <div class="mb-3">
                <label for="birthdate" class="form-label">Birth Date</label>
                <input type="date" class="form-control" id="birthdate" required>
            </div>

            <!-- Calculated Age -->
            <div class="mb-3">
                <label for="calculated-age" class="form-label">Your Age</label>
                <div id="calculated-age" class="form-control"></div>
            </div>

            <!-- Height -->
            <div class="mb-3">
                <label for="height" class="form-label">Height (cm)</label>
                <input type="number" class="form-control" id="height" placeholder="Enter your height in cm" required>
            </div>

            <!-- Weight -->
            <div class="mb-3">
                <label for="weight" class="form-label">Weight (kg)</label>
                <input type="number" class="form-control" id="weight" placeholder="Enter your weight in kg" required>
            </div>

            <!-- Lifestyle -->
            <div class="mb-3">
                <label for="lifestyle" class="form-label">Lifestyle</label>
                <select class="form-select" id="lifestyle" required>
                    <option selected disabled>Select your lifestyle</option>
                    <option value="Inactive">Sedentary (little or no exercise)</option>
                    <option value="Low Active">Light (exercise 1-3 times per week)</option>
                    <option value="Active">Moderate (exercise 3-5 times per week)</option>
                    <option value="Very Active">Active (daily exercise or intense exercise 3-4 times per week)</option>
                </select>
            </div>

            <!-- Fitness Goals -->
            <div class="mb-3">
                <label for="goals" class="form-label">Fitness Goals</label>
                <select class="form-select" id="goals" required>
                    <option selected disabled>Select your fitness goal</option>
                    <option value="diet">Diet</option>
                    <option value="gain muscle">Gain Muscle</option>
                    <option value="increase endurance">Increase Endurance</option>
                </select>
            </div>

            <!-- Usual Mealtimes -->
            <div class="mb-3">
                <label for="mealtimes" class="form-label">Usual Mealtimes</label>
                <div class="row">
                    <div class="col">
                        <label for="breakfast-time" class="form-label">Breakfast</label>
                        <input type="time" class="form-control" id="breakfast-time" required>
                    </div>
                    <div class="col">
                        <label for="lunch-time" class="form-label">Lunch</label>
                        <input type="time" class="form-control" id="lunch-time" required>
                    </div>
                    <div class="col">
                        <label for="dinner-time" class="form-label">Dinner</label>
                        <input type="time" class="form-control" id="dinner-time" required>
                    </div>
                </div>
            </div>

            <!-- Submit Button -->
            <div class="d-grid gap-2">
                <button type="submit" class="btn btn-primary" id="submitBtn">Submit</button>
            </div>
        </form>
    </div>

    <!-- Bootstrap JS and dependencies -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

    <!-- JavaScript for Calculating Age -->
    <script>
        const birthdateField = document.getElementById('birthdate');
        const calculatedAgeDiv = document.getElementById('calculated-age');

        birthdateField.addEventListener('input', () => {
            const birthdate = new Date(birthdateField.value);
            const today = new Date();
            let age = today.getFullYear() - birthdate.getFullYear();
            const monthDiff = today.getMonth() - birthdate.getMonth();

            if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthdate.getDate())) {
                age--;
            }

            calculatedAgeDiv.textContent = `You are ${age} years old.`;
        });
    </script>
    <script>
        // Request permission to show notifications
        if (Notification.permission === 'default') {
            Notification.requestPermission().then(permission => {
                if (permission !== 'granted') {
                    alert('You will not receive meal notifications.');
                }
            });
        }
    
        // Save meal times and set up notifications
        const registrationForm = document.getElementById('registrationForm');
    
        registrationForm.addEventListener('submit', (e) => {
            e.preventDefault();
    
            // Get the meal times from the form
            const breakfastTime = document.getElementById('breakfast-time').value;
            const lunchTime = document.getElementById('lunch-time').value;
            const dinnerTime = document.getElementById('dinner-time').value;
    
            // Store the meal times in localStorage
            localStorage.setItem('breakfastTime', breakfastTime);
            localStorage.setItem('lunchTime', lunchTime);
            localStorage.setItem('dinnerTime', dinnerTime);
    
            // Set notifications for each meal
            scheduleMealNotification('Breakfast', breakfastTime);
            scheduleMealNotification('Lunch', lunchTime);
            scheduleMealNotification('Dinner', dinnerTime);
    
            alert('Meal times saved! You will receive notifications.');
        });
    
        // Function to calculate the delay and schedule the notification
        function scheduleMealNotification(mealName, mealTime) {
            const mealDate = new Date();
            const [hour, minute] = mealTime.split(':').map(Number);
            mealDate.setHours(hour, minute, 0, 0);
    
            const now = new Date();
            const timeDifference = mealDate - now - (15 * 60 * 1000); // 15 minutes before meal time
    
            if (timeDifference > 0) {
                setTimeout(() => {
                    showNotification(mealName);
                }, timeDifference);
            }
        }
    
        // Function to show a browser notification
        function showNotification(mealName) {
            if (Notification.permission === 'granted') {
                new Notification(`${mealName} is in 15 minutes!`, {
                    body: `It's almost time for your ${mealName}.`,
                    icon: '/images/meal-icon.png' // Optional: Add an icon for the notification
                });
            }
        }
    
        // Schedule notifications on page load if meal times are stored
        window.addEventListener('load', () => {
            const breakfastTime = localStorage.getItem('breakfastTime');
            const lunchTime = localStorage.getItem('lunchTime');
            const dinnerTime = localStorage.getItem('dinnerTime');
    
            if (breakfastTime) scheduleMealNotification('Breakfast', breakfastTime);
            if (lunchTime) scheduleMealNotification('Lunch', lunchTime);
            if (dinnerTime) scheduleMealNotification('Dinner', dinnerTime);
        });
    </script>
    
</body>
</html>
