<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Snack Quest</title>
  <link rel="icon" type="image/png" href="/images/SnackQuest.png">
  <!-- Include Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- Include Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Include Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet">
  <!-- Importing Google Fonts - Poppins -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap">

  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,0,0">
  <!-- Custom CSS -->



  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-auth.js";
    import { getFirestore,collection, getDocs } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-firestore.js";
    
    // Fill in with your own web app's Firebase configuration
    const firebaseConfig = {
        apiKey: "AIzaSyBAhYdiPIDo0OtV-RoIiRVQCxvgofMb0js",
        authDomain: "snack-quest.firebaseapp.com",
        databaseURL: "https://snack-quest-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "snack-quest",
        storageBucket: "snack-quest.appspot.com",
        messagingSenderId: "974726219698",
        appId: "1:974726219698:web:361c5bf4bf98a8798c86ab",
        measurementId: "G-YXRNC4ZPTZ"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const logoutButton = document.getElementById('logout-button');

    logoutButton.addEventListener('click', async () => {
        await signOut(auth);
    });

    onAuthStateChanged(auth, (user) => {
        if (!user) {
            window.location.href = "index.html"
        }
    });
  </script>
  <script type="module" src="./Leaderboard.js"></script>
  
  <style>
    /* General Styles */
    body {
      font-family: 'Poppins', sans-serif;
      margin: 0;
      padding: 0;
      text-align: center;
      color: #fff;
      background: linear-gradient(135deg, #2b1d5a, #a296ca, #282b75, #1d161e, #4c1c46);
      background-size: 400% 400%;
      animation: gradientAnimation 30s ease infinite;
      overflow-x: hidden;
      cursor: url('carrot-cursor.png'), auto; /* Replace with your carrot cursor image path */
    }

    /* Navigation Bar Styles */
    .navbar {
      background: rgba(43, 29, 90, 0.9);
      padding: 0;
      border-bottom: 1px solid #444;
      z-index: 2;
    }

    .navbar-brand {
      color: #fff;
      font-size: 1.5em;
      padding: 15px;
      transition: all 0.3s;
    }

    .navbar-brand:hover {
      color: #2b1d5a;
      background-color: #fff;
    }

    /* Navigation Bar Button Styles */
    .navbar-nav .nav-link {
      background: red;
      color: white !important;
      border: none;
      padding: 20px;
      font: inherit;
      font-size: 1.6rem;
      cursor: pointer;
      outline: inherit;
      border-radius: 15px;
      box-shadow: 5px 5px 5px #000;
      margin: 5px;
      transition: all 0.3s;
      position: relative;
    }

    .navbar-nav .nav-link:hover {
      filter: brightness(120%);
      box-shadow: 10px 10px 10px #000;
    }

    .navbar-nav .nav-link:active {
      box-shadow: inset 2px 2px 10px #000;
    }

    .navbar-nav .nav-link::after {
      content: "";
      display: block;
      height: 5px;
      width: 0;
      background-color: #fff;
      transition: 0.1s width linear;
      margin: 0 auto;
    }

    .navbar-nav .nav-link:hover::after {
      width: 100%;
    }

    .navbar-nav .nav-link.active {
      background-color: #fff;
      color: red !important;
    }

    /* Page Container */
    .page-container {
      position: relative;
      width: 100%;
      min-height: 100vh;
      transition: transform 1s ease;
    }

    .page {
      position: absolute;
      width: 100%;
      min-height: 100vh;
      top: 0;
      left: 0;
      background: transparent;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
    }

    /* Angle Bracket Buttons */
    .angle-button {
      position: fixed;
      top: 50%;
      transform: translateY(-50%);
      font-size: 3em;
      color: #fff;
      background: rgba(0, 0, 0, 0.5);
      border: none;
      cursor: pointer;
      z-index: 5;
      width: 50px;
      height: 50px;
      line-height: 50px;
      text-align: center;
    }

    .angle-button.left {
      left: 10px;
    }

    .angle-button.right {
      right: 10px;
    }

    /* Heading Styles */
    h2 {
      margin: 60px 0 20px;
      font-size: 2.5em;
      color: #fff;
      text-shadow: 0 0 20px rgba(255,255,255,0.5);
    }

    /* Chart Container Styles */
    .chart-row {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      position: relative;
      z-index: 1;
    }

    .chart-container {
      position: relative;
      width: 100%;
      margin: 20px;
      cursor: pointer;
      transition: transform 0.5s;
      aspect-ratio: 1 / 1;
      max-width: 22%;
      border-radius: 50%;
      overflow: hidden;
      background: rgba(0, 0, 0, 0.5);
      box-shadow: 0 0 20px rgba(255,255,255,0.1);
    }

    .chart-container:hover {
      transform: scale(1.05);
      box-shadow: 0 0 30px rgba(255,255,255,0.3);
    }

    .chart-container canvas {
      width: 100%;
      height: 100%;
    }

    .chart-container .icon {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 4em;
      z-index: 1;
      pointer-events: none;
      color: #fff;
      text-shadow: 0 0 10px rgba(255,255,255,0.7);
    }

    .chart-container .info-card {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 90%;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(5px);
      padding: 20px;
      border-radius: 15px;
      opacity: 0;
      transition: opacity 0.5s;
      z-index: 2;
    }

    .chart-container.clicked .info-card {
      opacity: 1;
    }

    .chart-container.clicked canvas {
      filter: brightness(50%);
    }

    .chart-container .info-card p {
      color: #fff;
      margin: 0;
      font-size: 1em;
      text-shadow: 0 0 5px rgba(255,255,255,0.7);
    }

    /* Suggestion and Play Section Styles */
    .suggestion-play-section {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      align-items: center;
      margin: 40px 0;
      position: relative;
      z-index: 1;
    }

    .suggestion-box, .play-button-container {
      flex: 1;
      max-width: 45%;
      margin: 20px;
      color: #fff;
    }

    .suggestion-box h3 {
      color: #fff;
      margin-bottom: 20px;
      font-size: 1.8em;
      text-shadow: 0 0 10px rgba(255,255,255,0.5);
    }

    .suggestion-box input[type="text"] {
      width: 100%;
      padding: 15px;
      border: none;
      border-radius: 10px;
      font-size: 1em;
      background: rgba(255,255,255,0.1);
      color: #fff;
      box-shadow: inset 0 0 10px rgba(255,255,255,0.2);
    }

    .play-button-container {
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .play-button {
      position: relative;
      width: 200px;
      height: 200px;
      background: linear-gradient(135deg, #a296ca, #4c1c46);
      border-radius: 50%;
      box-shadow: 0 0 20px rgba(255,255,255,0.5);
      cursor: pointer;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      transition: transform 0.5s;
    }

    .play-button:hover {
      transform: rotate(360deg);
    }

    .play-button h3 {
      color: #fff;
      font-size: 2em;
      margin: 0;
      font-family: 'Comic Sans MS', cursive, sans-serif;
      z-index: 1;
      text-shadow: 0 0 10px rgba(255,255,255,0.7);
    }

    .play-button p {
      color: #fff;
      font-size: 1em;
      margin: 5px 0 0;
      z-index: 1;
    }

    /* Map Popup Styles */
    .map-popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 80%;
      max-width: 600px;
      background: rgba(0, 0, 0, 0.8);
      border-radius: 15px;
      padding: 20px;
      z-index: 1000;
      display: none;
    }

    .map-popup svg {
      width: 100%;
      height: auto;
    }

    .map-region {
      fill: #009bd9;
      stroke: #fff;
      stroke-width: 1px;
      transition: fill 0.3s;
    }

    .map-region:hover {
      fill: #44af35;
      cursor: url('carrot-cursor.png'), auto; /* Replace with your carrot cursor image path */
    }

    .map-close {
      position: absolute;
      top: 10px;
      right: 15px;
      font-size: 1.5em;
      color: #fff;
      cursor: pointer;
    }

    /* Responsive Layout */
    @media (max-width: 1199px) {
      .chart-container {
        max-width: 30%;
      }
    }

    @media (max-width: 991px) {
      .chart-container {
        max-width: 45%;
      }
      .suggestion-box, .play-button-container {
        max-width: 90%;
      }
      .suggestion-play-section {
        flex-direction: column;
      }
    }

    @media (max-width: 767px) {
      .chart-container {
        max-width: 90%;
      }
    }

    /* Food Nearby Gemini Chatbot styling */
    .chat-list .message .avatar {
        width:40px;
        height:40px;
        object-fit:cover;
        border-radius:50%;
        align-self:flex-start;
    }

    .chat-list .message.loading .avatar {
        animation:rotate 3s linear infinite;
    }

    @keyframes rotate {
        100% {
            transform:rotate(360deg);
        }
    }

    /* Pop-up Styles */
    .popup {
      display: none; /* Hidden by default */
      position: fixed;
      z-index: 999; /* Ensure the pop-up is above other elements */
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      width: 80%;
      max-width: 400px;
      background-color: rgba(0, 0, 0, 0.9); /* Semi-transparent black background */
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.3);
      color: white;
    }

    .popup-content {
      position: relative;
      padding: 20px;
      text-align: center;
    }

    .popup-content h3 {
      color: white;
      margin-bottom: 20px;
    }

    .popup-content input {
      width: 100%;
      padding: 10px;
      border-radius: 5px;
      border: none;
      background-color: rgba(255, 255, 255, 0.2);
      color: white;
      font-size: 16px;
    }

    .popup-content input::placeholder {
      color: rgba(255, 255, 255, 0.7);
    }

    /* Close Button */
    .close {
      position: absolute;
      top: 10px;
      right: 15px;
      color: red;
      font-size: 24px;
      cursor: pointer;
    }
  </style>
  <script>
    // DO NOT MODIFY THIS ARRAY
    var stations = ["woodlands", "yishun", "bishan", "ang mo kio", "toa payoh", "novena", "orchard", "somerset", 
            "dhoby ghaut", "city hall", "raffles place", "tanjong pagar", "outram park", "buona vista", 
            "clementi", "jurong east", "chinese garden", "lakeside", "boon lay", "pioneer", "joo koon", 
            "gul circle", "tuas crescent", "tuas west road", "tuas link", "choa chu kang", "bukit panjang", 
            "bukit batok", "queenstown", "redhill", "tiong bahru", "harbourfront", "serangoon", "punggol", 
            "sengkang", "hougang", "khatib", "yio chu kang", "marsiling", "admiralty", "canberra", 
            "bukit gombak", "bukit merah", "tampines", "pasir ris", "bedok", "simei", "eunos", "kallang", 
            "paya lebar", "changi", "expo", "downtown east", "joo chiat", "kembangan", "tanah merah", 
            "aljunied", "lavender", "bugis", "nicoll highway", "promenade", "bayfront", "esplanade", 
            "marina bay", "telok ayer", "mountbatten", "stadium", "dakota", "bartley", "lorong chuan", 
            "braddell", "potong pasir", "boon keng", "farrer park", "little india", "rochor", "bugis", 
            "bukit timah", "caldecott", "upper thomson", "bright hill", "sin ming", "springleaf", "lentor", 
            "mayflower", "khatib", "woodlands north", "woodlands south", "maxwell", "shenton way", 
            "gardens by the bay", "marine parade", "marine terrace", "siglap", "suntec", "downtown", 
            "chinatown", "telok blangah", "marymount", "one north", "haw par villa", "kent ridge", 
            "commonwealth", "king albert park", "sixth avenue"];
  </script>
</head>
<body>


    <div><button id="logout-button" class="btn btn-danger px-5" href>Logout</button></div>

  <!-- Angle Bracket Buttons -->
  <button class="angle-button left">&lt;</button>
  <button class="angle-button right">&gt;</button>

  <!-- Navigation Bar -->
  <nav class="navbar navbar-expand-lg">
    <div class="container-fluid">
      <a class="navbar-brand" href="#">Snack Quest</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" 
              aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon text-light"></span>
      </button>
      <div class="collapse navbar-collapse justify-content-center" id="navbarNav">
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link active" href="#" data-page="0">üåü Home</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#" data-page="1">üèÜ Leaderboard</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#" data-page="2">üçΩÔ∏è Food Nearby</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#" data-page="3">üìú History</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#" data-page="4">üë§ Account</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Page Container -->
  <div class="page-container">
    <!-- Home Page -->
    <div class="page" id="page0">
      <h2>Current Progress</h2>

      <!-- Donut Chart Containers -->
      <div class="chart-row">
        <!-- Calories Chart -->
        <div class="chart-container" id="caloriesContainer">
          <canvas id="caloriesChart"></canvas>
          <div class="icon">‚ö°</div>
          <div class="info-card">
            <p><strong>Total Calories needed today:</strong> 2,500 kcal</p>
            <p><strong>Calories Consumed today:</strong> 1,800 kcal</p>
          </div>
        </div>
        <!-- Carbs Chart -->
        <div class="chart-container" id="carbsContainer">
          <canvas id="carbsChart"></canvas>
          <div class="icon">ü•¶</div>
          <div class="info-card">
            <p><strong>Total Carbohydrates needed today:</strong> 300 grams</p>
            <p><strong>Carbohydrates Consumed today:</strong> 125 grams</p>
          </div>
        </div>
        <!-- Protein Chart -->
        <div class="chart-container" id="proteinContainer">
          <canvas id="proteinChart"></canvas>
          <div class="icon">üçñ</div>
          <div class="info-card">
            <p><strong>Total Protein needed today:</strong> 50 grams</p>
            <p><strong>Protein Consumed today:</strong> 35 grams</p>
          </div>
        </div>
        <!-- Fats Chart -->
        <div class="chart-container" id="fatsContainer">
          <canvas id="fatsChart"></canvas>
          <div class="icon">üßà</div>
          <div class="info-card">
            <p><strong>Total Fats needed today:</strong> 70 grams</p>
            <p><strong>Fats Consumed today:</strong> 55 grams</p>
          </div>
        </div>
      </div>

      <!-- Play Button -->
      <div class="play-button-container">
        <div class="play-button">
          <h3 style="font-family: 'Comic Sans MS', cursive, sans-serif;">Calculate My Nutrition</h3>
          <p>What have you eaten today?</p>
        </div>
      </div>

      <!-- Pop-up Textbox -->
      <div id="nutritionPopup" class="popup">
        <div class="popup-content">
          <span id="closePopup" class="close">&times;</span>
          <h3>What have you just eaten?</h3>
          <script type="module" src="HomeUpdate2.js"></script>
        <form id="foodInputForm">
          <div class="mb-3">
                  <label for="foodInput" class="form-label">foodInput</label>
                  <input type="text" class="form-control" id="foodInput" placeholder="foodInput" required>                    
          </div>
          
          <!-- Submit Button -->
          <div class="d-grid gap-2">
              <button type="submit" class="btn btn-primary" id="submitBtn">Submit</button>
          </div>
      </form>
        </div>
      </div>        
    </div>

    <!-- Leaderboard Page -->
    <div class="page" id="page1" style="left: 100%;">
      <div class="leaderboard-page">
        <h2>Leaderboard</h2>
        <!-- Content for the leaderboard page -->
        <div id="leaderboard-container"></div>
      </div>
    </div>

    <!-- Food Nearby Page -->
    <div class="page" id="page2" style="left: 200%;">
      <div class="food-nearby-page">
        <h2>Food Nearby Recommendations</h2>
        <h3>Please enter the name of the nearest MRT Station</h3>
        <!-- Content for the food nearby page -->
        <!-- Chat List / Container -->
        <div class="chat-list"></div>

        <!-- Typing Area -->
        <div class="typing-area">
          <form action="#" class="typing-form">
              <div class="input-wrapper">
                  <input type="text" placeholder="Enter a prompt here" class="typing-input" id="typing-input" onkeyup="showHint(this.value)" required><br>
                  <select id="hint" onchange="changeStation()" size="10">
                    <option value="none">no suggestion</option>
                  </select>
                  <button class="icon material-symbols-rounded">send</button>
              </div>
              <div class="action-buttons">
                  <span class="icon material-symbols-rounded">light_mode</span>
                  <span class="icon material-symbols-rounded">delete</span>
              </div>
          </form>
        </div>
      </div>
    </div>

    <!-- History Page -->
    <div class="page" id="page3" style="left: 300%;">
      <div class="history-page">
        <h2>History</h2>
        <!-- Content for the history page -->
      </div>
    </div>

    <!-- Account Page -->
    <div class="page" id="page4" style="left: 400%;">
      <div class="account-page">
        <h2>Account</h2>
        <!-- Content for the account page -->
        <div id="userInfo">
          <h3>Current User Information</h3>
          <p><strong>Username:</strong> <span id="display-username"></span></p>
          <p><strong>Birthdate:</strong> <span id="display-birthdate"></span></p>
          <p><strong>Height:</strong> <span id="display-height"></span> cm</p>
          <p><strong>Weight:</strong> <span id="display-weight"></span> kg</p>
          <p><strong>Lifestyle:</strong> <span id="display-lifestyle"></span></p>
          <p><strong>Goals:</strong> <span id="display-goals"></span></p>
          <p><strong>Breakfast Time:</strong> <span id="display-breakfast-time"></span></p>
          <p><strong>Lunch Time:</strong> <span id="display-lunch-time"></span></p>
          <p><strong>Dinner Time:</strong> <span id="display-dinner-time"></span></p>
        </div>
        <h3>Update User Information</h3>
        <form id="updateForm">
          <input type="text" id="update-username" placeholder="Username" />
          <button type="button" id="check-username-btn">Check Username</button>
          <span id="username-status"></span>
          <input type="date" id="birthdate" placeholder="Birthdate" />
          <input type="number" id="height" placeholder="Height (cm)" />
          <input type="number" id="weight" placeholder="Weight (kg)" />
          <input type="text" id="lifestyle" placeholder="Lifestyle" />
          <input type="text" id="update-goals" placeholder="Goals" />
          <input type="time" id="update-breakfast-time" placeholder="Breakfast Time" />
          <input type="time" id="update-lunch-time" placeholder="Lunch Time" />
          <input type="time" id="update-dinner-time" placeholder="Dinner Time" />
          <input type="text" id="sex" placeholder="sex"/>
          <input type="hidden" id="currentAge" name="currentAge" />

          <!--Nutrition API-->
          <input type="hidden" id="carbohydrates" name="carbohydrates">
          <input type="hidden" id="protein" name="protein">
          <input type="hidden" id="fat" name="fat">
          <input type="hidden" id="fiber" name="fiber">
          <input type="hidden" id="bmi" name="bmi">
          <input type="hidden" id="calorieNeeds" name="calorieNeeds">
          <button type="submit">Update</button>
        </form>
        <script type="module" src="calculateAge.js"></script>  
        <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
        <script type="module" src="NutritionAPI.js"></script>  
        <script type="module" src="AccountUpdate.js"></script>
      </div>
    </div>
  </div>

  <!-- Include Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
  <!-- JavaScript to create charts and handle interactions -->
  <script>
    // Nutrient data with colors matching the icons
    const chartData = {
      calories: { consumed: 1800, goal: 2500, color: '#FFA500', label: 'Calories' }, // Orange for lightning bolt
      carbs: { consumed: 125, goal: 300, color: '#32CD32', label: 'Carbohydrates' }, // Green for broccoli
      protein: { consumed: 35, goal: 50, color: '#FF4500', label: 'Protein' }, // Red-orange for meat
      fats: { consumed: 55, goal: 70, color: '#FFD700', label: 'Fats' } // Gold for butter
    };

    // Function to create Donut Chart
    function createDonutChart(chartId, nutrientData) {
      const ctx = document.getElementById(chartId).getContext('2d');

      // Create gradient
      const gradient = ctx.createLinearGradient(0, 0, 0, ctx.canvas.height);
      gradient.addColorStop(0, nutrientData.color);
      gradient.addColorStop(1, nutrientData.color);

      return new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: ['Consumed', 'Remaining'],
          datasets: [{
            data: [nutrientData.consumed, nutrientData.goal - nutrientData.consumed],
            backgroundColor: [
              gradient,
              '#1d161e' // Dark background for contrast
            ],
            hoverOffset: 4,
            borderWidth: 0
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          cutout: '60%',
          plugins: {
            legend: {
              display: false
            },
            tooltip: {
              callbacks: {
                label: function(tooltipItem) {
                  const label = tooltipItem.label;
                  const value = tooltipItem.raw;
                  const unit = nutrientData.label === 'Calories' ? ' kcal' : ' grams';
                  return `${label}: ${value}${unit}`;
                }
              }
            },
            title: {
              display: true,
              text: nutrientData.label,
              color: '#fff',
              font: {
                size: 18
              }
            }
          }
        }
      });
    }

    // Create Charts
    const caloriesChart = createDonutChart('caloriesChart', chartData.calories);
    const carbsChart = createDonutChart('carbsChart', chartData.carbs);
    const proteinChart = createDonutChart('proteinChart', chartData.protein);
    const fatsChart = createDonutChart('fatsChart', chartData.fats);

    // Add click event listeners to chart containers
    document.getElementById('caloriesContainer').addEventListener('click', function() {
      this.classList.toggle('clicked');
    });
    document.getElementById('carbsContainer').addEventListener('click', function() {
      this.classList.toggle('clicked');
    });
    document.getElementById('proteinContainer').addEventListener('click', function() {
      this.classList.toggle('clicked');
    });
    document.getElementById('fatsContainer').addEventListener('click', function() {
      this.classList.toggle('clicked');
    });

    // Navigation Functionality
    const navLinks = document.querySelectorAll('.nav-link');
    const pages = document.querySelectorAll('.page');
    const pageContainer = document.querySelector('.page-container');
    let currentPageIndex = 0;

    navLinks.forEach(link => {
      link.addEventListener('click', function(e) {
        e.preventDefault();
        const targetPageIndex = parseInt(this.getAttribute('data-page'));
        navigateToPage(targetPageIndex);
      });
    });

    // Angle Bracket Buttons Functionality
    const leftButton = document.querySelector('.angle-button.left');
    const rightButton = document.querySelector('.angle-button.right');

    leftButton.addEventListener('click', function() {
      const targetPageIndex = currentPageIndex - 1 >= 0 ? currentPageIndex - 1 : pages.length - 1;
      navigateToPage(targetPageIndex);
    });

    rightButton.addEventListener('click', function() {
      const targetPageIndex = (currentPageIndex + 1) % pages.length;
      navigateToPage(targetPageIndex);
    });

    function navigateToPage(index) {
      const offset = index * -100;
      pageContainer.style.transform = `translateX(${offset}%)`;
      currentPageIndex = index;

      // Update active class on nav links
      navLinks.forEach(link => link.classList.remove('active'));
      navLinks[currentPageIndex].classList.add('active');
    }

    // Set Home as the initial active page
    navigateToPage(0);

    // Food Nearby Gemini chatbot
    const typingForm = document.querySelector(".typing-form");
    const chatList = document.querySelector(".chat-list");

    let userMessage = null;
    let wrapperText = null;
    let fullMessage = null;
    

    // API configuration
    const API_KEY = "AIzaSyDq4SCyitS7UFjOYd_4KcPMpYBW4gdgBFU";
    const API_URL = `https://generativelanguage.googleapis.com/v1/models/gemini-pro:generateContent?key=${API_KEY}`;

    // Create a new message element and return it
    const createMessageElement = (content, ...classes) => {
        const div = document.createElement("div");
        div.classList.add("message", ...classes);
        div.innerHTML = content; //Prof disallows us to use innerHTML

        // // Create message content container
        // const messageContentDiv = document.createElement("div");
        // messageContentDiv.classList.add("message-content");

        // // Create image element
        // const img = document.createElement("img");
        // img.setAttribute("src", "images/user.jpg");
        // img.setAttribute("alt", "User Image");
        // img.classList.add("avatar");

        // // Create text paragraph element
        // const p = document.createElement("p");
        // p.classList.add("text");
        // p.textContent = content;  // Use textContent to avoid XSS

        // // Append elements
        // messageContentDiv.appendChild(img);
        // messageContentDiv.appendChild(p);
        // div.appendChild(messageContentDiv);
        return div;
    }

    // Show typing effect by displaying words one by one
    const showTypingEffect = (text, textElement) => {
        const words = text.split(' ');
        let currentWordIndex = 0;

        const typingInterval = setInterval(() => {
            //Append each word to the text element with a space
            textElement.innerText += (currentWordIndex === 0 ? '' : ' ') + words[currentWordIndex++];
            
            // If all words are displayed
            if(currentWordIndex === words.length) {
                clearInterval(typingInterval);
            }
        }, 75);
    }

    const generateAPIResponse = async (incomingMessageDiv) => {
        const textElement = incomingMessageDiv.querySelector(".text"); // Get text element

        //Send a POST request to the API with the user's message
        try {
            const response = await fetch(API_URL, {
                method: "POST",
                headers: { "Content-Type": "application/json"},
                body: JSON.stringify({
                    contents: [{
                        role: "user",
                        parts: [{ text: fullMessage }]
                    }]
                })
            });

            const data = await response.json();

            // Get the API response text
            const apiResponse = data?.candidates[0].content.parts[0].text;
            showTypingEffect(apiResponse, textElement);
        } catch (error) {
            console.log(error);
        } finally {
            incomingMessageDiv.classList.remove("loading");
        }
    }

    // Show a loading animation while waiting for the API response
    const showLoadingAnimation = () => {
        const html = `<div class="message-content">
                    <img src="images/gemini.svg" alt="Gemini Image" class="avatar">
                    <p class="text"></p>
                    <div class="loading-indicator">
                        <div class="loading-bar"></div>
                        <div class="loading-bar"></div>
                        <div class="loading-bar"></div>
                    </div>
                </div>
                <span onclick="copyMessage(this)" class="icon material-symbols-rounded">content_copy</span>`;
        
        const incomingMessageDiv = createMessageElement(html,"incoming","loading");
        chatList.appendChild(incomingMessageDiv);

        generateAPIResponse(incomingMessageDiv);
    }

    // Copy message text to the clipboard
    const copyMessage = (copyIcon) => {
        const messageText = copyIcon.parentElement.querySelector(".text").innerText;

        navigator.clipboard.writeText(messageText);
        copyIcon.innerText = "done"; // Show tick icon
        setTimeout(() => copyIcon.innerText = "content_copy", 1000); // Revert icon after 1 second

    }

    // Handle sending outgoing chat messages
    const handleOutgoingChat = () => {
        wrapperText = "Please provide only the exact address of the 7 Eleven outlet nearest to this MRT Station: ";
        userMessage = typingForm.querySelector(".typing-input").value.trim();
        if(!userMessage) return; //Exit if there is no message

        fullMessage = wrapperText + userMessage;

        const html = `<div class="message-content">
                    <img src="images/user.jpg" alt="User Image" class="avatar">
                    <p class="text"></p>

                </div>`;
        
        const outgoingMessageDiv = createMessageElement(html,"outgoing");
        outgoingMessageDiv.querySelector(".text").innerText = userMessage;
        chatList.appendChild(outgoingMessageDiv);

        typingForm.reset(); // Clear input field
        setTimeout(showLoadingAnimation, 500); // Show loading animation after a delay
    }

    // Prevent default form submission and handle outgoing chat
    typingForm.addEventListener("submit", (e) => {
        e.preventDefault();

        handleOutgoingChat();
    });

    // Dropdown hint for Food Nearby text-input auto-fill
    var hint = document.getElementById("hint");
    var typingInput = document.getElementById("typing-input");

    function changeStation() {
        var newStation = hint.value;
        // console.log(color);
        // document.body.style.backgroundColor = newStation;
        typingInput.value = newStation;
    }

    function showHint(q) {
        clearOptions();
    //Q.   what is clearOptions() for?
        var found = false;
        // lookup all hints from array if q is not ""¬†
        if¬†(q.length¬†!=¬†0 && q.trim() != "") {¬†¬†¬†¬†¬†
            console.log(q);
          
            q = q.toLowerCase();¬† 
            var len = q.length;¬†¬†
            for (var station of stations) {¬†¬†
                // console.log(color);
                if(station.toLowerCase().startsWith(q)) {¬†¬†
                    found = true;¬†¬†¬†¬†  ¬†¬†¬† 
                    addOption(station);¬†¬†¬†¬†¬†        ¬†¬†
                }¬†¬†
            }  
        }
        if (!found)
            addOption("no suggestion");
    }

    function addOption(station) {
        var newOption = document.createElement("option");
        var textNode = document.createTextNode(station);
        newOption.appendChild(textNode);
        newOption.value = station;
        hint.appendChild(newOption);
    }

    function clearOptions() {
        var len = hint.children.length;
        for (let i=0;i<len;i++) {
            hint.children[0].remove();
    // Q.   //Q.    but after removing index zero, 
    //won't the elements in the array move 1 index down and repopulate index zero?
    //A.    Because the code always removes from index 0, 
    //the increment of i does not cause any skipping.
    //I misinterpreted as removing[i] instead of removing[0]
        }
        //while-loop is more intuitive:
        //function clearOptions() {
            // while (hint.children.length > 0) {
            //     hint.children[0].remove();
    }

    // JavaScript for handling pop-up visibility
    const nutritionPopup = document.getElementById('nutritionPopup');
    const closePopup = document.getElementById('closePopup');
    const playButton = document.querySelector('.play-button');

    // Show pop-up when "Calculate My Nutrition" button is clicked
    playButton.addEventListener('click', function() {
      nutritionPopup.style.display = 'block';
    });

    // Hide pop-up when the red cross is clicked
    closePopup.addEventListener('click', function() {
      nutritionPopup.style.display = 'none';
    });

    // Optional: Close the pop-up when clicking outside of it
    window.addEventListener('click', function(event) {
      if (event.target === nutritionPopup) {
        nutritionPopup.style.display = 'none';
      }
    });
  </script>

</body>
</html>
